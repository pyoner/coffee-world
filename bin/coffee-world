#!/usr/bin/env coffee

# requires
cp = require 'child_process'
cssCompiler = require '../lib/cssCompiler.coffee'
fs = require 'fs'

# globals
watchedFiles = {}

# functions
poller = () ->
	cp.exec "find . -iname *.css.coffee -print", (error, stdout, stderr) ->
		fileList = stdout.split('\n')
		for file in fileList
			compileIfNeeded file if file != ''

compileIfNeeded = (file) ->
	fs.stat file, (err, stats) ->
		oldModifiedTime = watchedFiles[file]
		newModifiedTime = new Date(stats.mtime)
		watchedFiles[file] = newModifiedTime
		if newModifiedTime > oldModifiedTime
		    cssCompiler.compileFile file

# main
setInterval poller, 1000